const _0x1c8d6a=_0x4e59;(function(_0x3c610a,_0x294aa7){const _0x27a233=_0x4e59,_0x526b23=_0x3c610a();while(!![]){try{const _0x439efa=-parseInt(_0x27a233(0xfd))/0x1*(parseInt(_0x27a233(0x114))/0x2)+-parseInt(_0x27a233(0x106))/0x3+parseInt(_0x27a233(0x163))/0x4*(-parseInt(_0x27a233(0x15b))/0x5)+-parseInt(_0x27a233(0x17f))/0x6*(parseInt(_0x27a233(0x105))/0x7)+-parseInt(_0x27a233(0x14f))/0x8+-parseInt(_0x27a233(0x148))/0x9*(parseInt(_0x27a233(0x128))/0xa)+parseInt(_0x27a233(0xff))/0xb*(parseInt(_0x27a233(0x13e))/0xc);if(_0x439efa===_0x294aa7)break;else _0x526b23['push'](_0x526b23['shift']());}catch(_0x4a0350){_0x526b23['push'](_0x526b23['shift']());}}}(_0x2f9a,0x95c26));import _0x2eb5e3 from'../../lib/config/config.js';import{randomBytes}from'crypto';import _0x389e23 from'../../lib/plugins/plugin.js';import*as _0x2a5971 from'icqq/lib/core/protobuf/index.js';import*as _0x34bf79 from'zlib';import{promisify}from'util';import{Contactable}from'icqq/lib/internal/contactable.js';import{Group}from'icqq/lib/group.js';import{User}from'icqq/lib/friend.js';import{escapeXml,uuid}from'icqq/lib/common.js';import{rand2uuid}from'icqq/lib/message/index.js';function _0x4e59(_0x10a3ed,_0x4c478a){const _0x2f9a25=_0x2f9a();return _0x4e59=function(_0x4e59c2,_0x9821cf){_0x4e59c2=_0x4e59c2-0xf6;let _0x13bcf5=_0x2f9a25[_0x4e59c2];return _0x13bcf5;},_0x4e59(_0x10a3ed,_0x4c478a);}import{timestamp}from'icqq/lib/core/constants.js';import{PrivateMessage,segment}from'icqq';import _0x2193f5 from'../../lib/plugins/loader.js';import _0x801fea from'lodash';import _0x38c0a9 from'moment';import _0x4458ee from'fs';import _0xd2544e from'chokidar';import _0x19957e from'../Lain-plugin/lib/common/common.js';const gzip=promisify(_0x34bf79['gzip']),originalPreprocess=Contactable[_0x1c8d6a(0x16b)][_0x1c8d6a(0x183)],originalSendMsg=Group[_0x1c8d6a(0x16b)]['sendMsg'],originalSendMsgPrivate=User[_0x1c8d6a(0x16b)][_0x1c8d6a(0x156)],originalReply=_0x2193f5[_0x1c8d6a(0x176)];class Button{constructor(){const _0xbcbcf6=_0x1c8d6a;this[_0xbcbcf6(0x17e)]=_0xbcbcf6(0x198),this['botModules']=[],this['initialize']();}async[_0x1c8d6a(0x171)](_0x1707c9){const _0x42822d=_0x1c8d6a;_0x1707c9=_0x1707c9['replace'](/\\/g,'/');try{let _0x2358e3=(await import(_0x42822d(0x119)+_0x1707c9+'?'+_0x38c0a9()['format']('x')))[_0x42822d(0x15e)];_0x2358e3=new _0x2358e3(),_0x2358e3['plugin'][_0x42822d(0x10f)]=_0x1707c9,this[_0x42822d(0x169)]['push'](_0x2358e3),this[_0x42822d(0x169)][_0x42822d(0x167)]((_0x55f81b,_0x3c3681)=>_0x55f81b[_0x42822d(0x17e)][_0x42822d(0x127)]-_0x3c3681[_0x42822d(0x17e)]['priority']),logger[_0x42822d(0x18f)](_0x42822d(0x184)+_0x1707c9+_0x42822d(0x102));}catch(_0x29872c){logger['error'](_0x42822d(0x109)+_0x1707c9+'\x20时出错：'+_0x29872c[_0x42822d(0x103)]);}}['unloadModule'](_0x30ba34){const _0x31a164=_0x1c8d6a,_0x27508d=this[_0x31a164(0x169)][_0x31a164(0x160)](_0x4c0c23=>_0x4c0c23[_0x31a164(0x17e)][_0x31a164(0x10f)]===_0x30ba34);if(_0x27508d!==-0x1)this['botModules'][_0x31a164(0x159)](_0x27508d,0x1);this[_0x31a164(0x169)][_0x31a164(0x167)]((_0x41d70a,_0x56a3ed)=>_0x41d70a[_0x31a164(0x17e)][_0x31a164(0x127)]-_0x56a3ed[_0x31a164(0x17e)][_0x31a164(0x127)]);}async[_0x1c8d6a(0x17d)](_0xd08c38,_0x13f0ba,_0x54d36f){const _0x76631a=_0x1c8d6a;_0xd08c38='./'+_0xd08c38['replace'](/\\/g,'/');if(_0xd08c38[_0x76631a(0x17c)]('.js')){if(_0x13f0ba===_0x76631a(0x18c)){this[_0x76631a(0x11d)](_0xd08c38),await this[_0x76631a(0x171)](_0xd08c38);if(!_0x54d36f)logger[_0x76631a(0x139)](_0x76631a(0x157)+_0xd08c38+']');}else{if(_0x13f0ba===_0x76631a(0x18c)||_0x13f0ba===_0x76631a(0x11a))this[_0x76631a(0x11d)](_0xd08c38),await this[_0x76631a(0x171)](_0xd08c38),logger[_0x76631a(0x139)]('[Lain-plugin][修改按钮插件]['+_0xd08c38+']');else _0x13f0ba===_0x76631a(0x118)&&(this['unloadModule'](_0xd08c38),logger[_0x76631a(0x139)](_0x76631a(0x17b)+_0xd08c38+']'));}}}async['initialize'](){const _0x17e83b=_0x1c8d6a;try{const _0x53b832=[],_0x436ca1=_0x4458ee[_0x17e83b(0x13f)](this[_0x17e83b(0x17e)]);for(let _0x319158 of _0x436ca1){const _0x5cfdde=this[_0x17e83b(0x17e)]+('/'+_0x319158);if(!_0x4458ee['lstatSync'](_0x5cfdde)[_0x17e83b(0x112)]())continue;_0x53b832['push'](this[_0x17e83b(0x17e)]+('/'+_0x319158+'/lain.support.js'));}const _0x3b70ac=_0x4458ee[_0x17e83b(0x13f)](this[_0x17e83b(0x17e)]+_0x17e83b(0x123));for(let _0x1cf4a5 of _0x3b70ac){const _0x54277b=this[_0x17e83b(0x17e)]+(_0x17e83b(0x164)+_0x1cf4a5);if(!_0x4458ee[_0x17e83b(0x143)](_0x54277b)['isDirectory']())continue;_0x53b832['push'](_0x54277b);}return _0x53b832[_0x17e83b(0x101)](_0x5dd62b=>{const _0x3b2673=_0x17e83b;let _0x215cbc=!![];const _0x1d7b39=_0xd2544e['watch'](_0x5dd62b,{'ignored':/[/\\]\./,'persistent':!![]});return _0x1d7b39['on'](_0x3b2673(0x18c),async _0x3556c0=>{const _0x282cd9=_0x3b2673;await this['handleFileChange'](_0x3556c0,_0x282cd9(0x18c),_0x215cbc);if(_0x215cbc)_0x215cbc=![];})['on'](_0x3b2673(0x11a),async _0x5aab6e=>await this[_0x3b2673(0x17d)](_0x5aab6e,_0x3b2673(0x11a)))['on']('unlink',async _0x4ea05e=>await this[_0x3b2673(0x17d)](_0x4ea05e,_0x3b2673(0x118))),_0x1d7b39;}),this[_0x17e83b(0x169)];}catch(_0x5e69bb){logger[_0x17e83b(0x158)](_0x17e83b(0x13b)+_0x5e69bb[_0x17e83b(0x103)]);}}}const loadedButtons=new Button();function _0x2f9a(){const _0x561167=['com.tencent.multimsg','[聊天记录]','_path','slice','elems','isDirectory','sender','2lnXInI','normal','markdown','type','unlink','../.','change','isArray','brief','unloadModule','forEach','xml','group_id','warn','[@全体成员](mqqapi://markdown/mention?at_type=2&at_tinyid=everyone)\x0a','/Lain-plugin/plugins','left','FormatFile','_uploadMultiMsg','priority','70qORKVi','length','push','now','specify_user_ids','image','friend','json','writeUInt32BE','rich','filter',']\x20(','msg','replace','allocUnsafe','mute_left','条转发消息','mark','isBuffer','读取插件目录时出错：','isGroup','image_force_md','12504IfauKk','readdirSync','trpc.group.long_msg_interface.MsgService.SsoSendLongMsg','get','toUpperCase','lstatSync','无图床，不发markdown','bind','pickUser','count','35667hivOLt','includes','replyNew','sendmsg_error','![图片\x20#','permission','encode','2757864EFRStP','stringify','all','label','uniseq','data','time','sendMsg','[Lain-plugin][新增按钮插件][','error','splice','buttons','1312305fzuMZs','imageToUrl','meta','default','app','findIndex','MultiMsg','_newUploadMultiMsg','8oLbFew','/Lain-plugin/plugins/','random','prompt','sort','parse','botModules','object','prototype','every','catch','enter','test','truncate','loadModule','find','url','target','render_data','reply','action','decode','bot','uid','[Lain-plugin][卸载按钮插件][','endsWith','handleFileChange','plugin','5946918woptYE','nickname','resid','isGuild','_preprocess','按钮模块\x20','[XML]','node','string','recallMsg','readInt32BE','content','gml','add','uin','0.0.0.5','debug','rows','sendUni','unsupport_tips','_downloadMultiMsg','发送消息错误:','floor','全体成员','detail','./plugins','file','masterQQ','button','Read\x20button\x20from\x20lain\x20error','message_id','rule','info','9651BxNKiT','appid','30679FacCle','user_id','map','\x20已加载。','message','text','7Wzleoa','1183572rBnsud','exec','reg','导入按钮模块\x20','unshift','group','card'];_0x2f9a=function(){return _0x561167;};return _0x2f9a();}async function generateButton(_0x4bbd6a){const _0x239a15=_0x1c8d6a;try{for(let _0x45df33 of loadedButtons[_0x239a15(0x169)]){for(let _0x13f11d of _0x45df33[_0x239a15(0x17e)][_0x239a15(0xfb)]){const _0x5ce9c1=new RegExp(_0x13f11d[_0x239a15(0x108)]);if(_0x5ce9c1[_0x239a15(0x16f)](_0x4bbd6a['msg'])){_0x45df33['e']=_0x4bbd6a;let _0x4f4b07=await _0x45df33[_0x13f11d['fnc']](_0x4bbd6a);const _0x59ab80=[];if(_0x4f4b07){if(!Array[_0x239a15(0x11b)](_0x4f4b07))_0x4f4b07=[_0x4f4b07];return _0x4f4b07['forEach'](_0x10be8c=>{const _0x366e07=_0x239a15;_0x59ab80[_0x366e07(0x12a)]({'buttons':_0x10be8c[_0x366e07(0x15a)]});}),_0x59ab80;}return![];}}}}catch(_0x7703){return _0x19957e[_0x239a15(0x158)](_0x239a15(0xf9),_0x7703),![];}}_0x2193f5[_0x1c8d6a(0x176)]=async function(_0x54582c){const _0x3fd9b9=_0x1c8d6a;_0x54582c[_0x3fd9b9(0x176)]?(_0x54582c[_0x3fd9b9(0x14a)]=_0x54582c[_0x3fd9b9(0x176)],_0x54582c['reply']=async(_0x5ea23a='',_0x2cd367=![],_0x5a81b5={})=>{const _0x1bd0c8=_0x3fd9b9;if(!_0x5ea23a)return![];if(_0x54582c[_0x1bd0c8(0x13c)]&&_0x54582c?.[_0x1bd0c8(0x10b)]?.[_0x1bd0c8(0x137)]>0x0)return![];let {recallMsg:recallMsg=0x0,at:at=''}=_0x5a81b5;if(at&&_0x54582c[_0x1bd0c8(0x13c)]){let _0x5172df='';_0x54582c?.['sender']?.[_0x1bd0c8(0x10c)]&&(_0x5172df=_0x801fea['truncate'](_0x54582c['sender'][_0x1bd0c8(0x10c)],{'length':0xa}));if(at===!![])at=Number(_0x54582c[_0x1bd0c8(0x100)])||String(_0x54582c[_0x1bd0c8(0x100)]);else{if(!isNaN(at)){if(_0x54582c['isGuild'])_0x5172df=_0x54582c[_0x1bd0c8(0x113)]?.[_0x1bd0c8(0x180)];else{let _0x2fee9a=_0x54582c['group']['pickMember'](at)[_0x1bd0c8(0xfc)];_0x5172df=_0x2fee9a?.[_0x1bd0c8(0x10c)]??_0x2fee9a?.['nickname'];}_0x5172df=_0x801fea[_0x1bd0c8(0x170)](_0x5172df,{'length':0xa});}}Array[_0x1bd0c8(0x11b)](_0x5ea23a)?_0x5ea23a[_0x1bd0c8(0x10a)](segment['at'](at,_0x5172df),'\x0a'):_0x5ea23a=[segment['at'](at,_0x5172df),'\x0a',_0x5ea23a];}let _0x2479f3;try{const _0x2f1a4a=await generateButton(_0x54582c);_0x2f1a4a&&(!Array[_0x1bd0c8(0x11b)](_0x5ea23a)&&(_0x5ea23a=[_0x5ea23a]),_0x5ea23a[_0x1bd0c8(0x12a)]({'type':_0x1bd0c8(0xf8),'content':{'appid':0x1,'rows':_0x2f1a4a}})),_0x2479f3=await _0x54582c[_0x1bd0c8(0x14a)](_0x5ea23a,_0x2cd367);}catch(_0x3950b1){if(typeof _0x5ea23a!='string'){if(_0x5ea23a['type']==_0x1bd0c8(0x12d)&&Buffer[_0x1bd0c8(0x13a)](_0x5ea23a?.[_0x1bd0c8(0xf6)]))_0x5ea23a[_0x1bd0c8(0xf6)]={};_0x5ea23a=_0x801fea[_0x1bd0c8(0x170)](JSON[_0x1bd0c8(0x150)](_0x5ea23a),{'length':0x12c});}logger[_0x1bd0c8(0x158)]('发送消息错误:'+_0x5ea23a),logger[_0x1bd0c8(0x158)](_0x3950b1);if(_0x2eb5e3[_0x1bd0c8(0x179)][_0x1bd0c8(0x14b)])Bot[Bot[_0x1bd0c8(0x18d)]][_0x1bd0c8(0x146)](_0x2eb5e3[_0x1bd0c8(0xf7)][0x0])[_0x1bd0c8(0x156)](_0x1bd0c8(0x194)+_0x5ea23a);}if(!_0x54582c[_0x1bd0c8(0x182)]&&recallMsg>0x0&&_0x2479f3?.['message_id']){if(_0x54582c[_0x1bd0c8(0x13c)])setTimeout(()=>_0x54582c[_0x1bd0c8(0x10b)][_0x1bd0c8(0x188)](_0x2479f3[_0x1bd0c8(0xfa)]),recallMsg*0x3e8);else _0x54582c['friend']&&setTimeout(()=>_0x54582c['friend'][_0x1bd0c8(0x188)](_0x2479f3[_0x1bd0c8(0xfa)]),recallMsg*0x3e8);}return this[_0x1bd0c8(0x147)](_0x54582c,_0x5ea23a),_0x2479f3;}):_0x54582c[_0x3fd9b9(0x176)]=async(_0x2dea84='',_0x3f464a=![],_0x3c77c4={})=>{const _0x30302f=_0x3fd9b9;if(!_0x2dea84)return![];this[_0x30302f(0x147)](_0x54582c,_0x2dea84);if(_0x54582c['group_id'])return await _0x54582c['group'][_0x30302f(0x156)](_0x2dea84)['catch'](_0x4150bf=>{const _0x56ac37=_0x30302f;logger[_0x56ac37(0x121)](_0x4150bf);});else{let _0x4ef13a=_0x54582c[_0x30302f(0x179)]['fl'][_0x30302f(0x141)](_0x54582c[_0x30302f(0x100)]);if(!_0x4ef13a)return;return await _0x54582c['bot'][_0x30302f(0x146)](_0x54582c[_0x30302f(0x100)])[_0x30302f(0x156)](_0x2dea84)[_0x30302f(0x16d)](_0x3ffe2f=>{const _0x46cb39=_0x30302f;logger[_0x46cb39(0x121)](_0x3ffe2f);});}};}[_0x1c8d6a(0x145)](_0x2193f5),Contactable[_0x1c8d6a(0x16b)][_0x1c8d6a(0x183)]=async function(_0x247959,_0x1a7571){const _0x39e3bb=_0x1c8d6a;!Array['isArray'](_0x247959)&&(_0x247959=[_0x247959]);let _0x554cc0='',_0x2fd4a0,_0x5e9dd6;const _0x17e0ec=_0x247959[_0x39e3bb(0x132)](_0x3fc469=>typeof _0x3fc469!==_0x39e3bb(0x187)&&_0x3fc469[_0x39e3bb(0x117)]===_0x39e3bb(0x186));_0x247959=_0x247959[_0x39e3bb(0x132)](_0xf4c068=>!_0x17e0ec[_0x39e3bb(0x149)](_0xf4c068))[_0x39e3bb(0x101)](_0x34c491=>typeof _0x34c491===_0x39e3bb(0x187)?{'type':_0x39e3bb(0x104),'text':_0x34c491}:_0x34c491);const _0x584b2c=[];logger[_0x39e3bb(0x18f)](_0x247959);if(!_0x2eb5e3[_0x39e3bb(0x179)][_0x39e3bb(0x13d)]&&_0x247959[_0x39e3bb(0x16c)](_0x288359=>_0x288359[_0x39e3bb(0x117)]==='image'))return await originalPreprocess[_0x39e3bb(0x145)](this)(_0x247959,_0x1a7571);for(let _0x34d185 of _0x247959){switch(_0x34d185[_0x39e3bb(0x117)]){case _0x39e3bb(0x104):{_0x554cc0+=_0x34d185[_0x39e3bb(0x104)];break;}case _0x39e3bb(0x12d):{if(Bot['FormatFile']&&Bot[_0x39e3bb(0x15c)]&&typeof Bot['imageToUrl']==='function'){if(_0x34d185?.[_0x39e3bb(0x173)])_0x34d185[_0x39e3bb(0xf6)]=_0x34d185[_0x39e3bb(0x173)];_0x34d185[_0x39e3bb(0xf6)]=await Bot?.[_0x39e3bb(0x125)](_0x34d185['file'])||_0x34d185[_0x39e3bb(0xf6)];const {width:_0x2cf105,height:_0x37c7a1,url:_0x59c1ff}=await Bot[_0x39e3bb(0x15c)](_0x34d185[_0x39e3bb(0xf6)]);_0x554cc0+=_0x39e3bb(0x14c)+_0x2cf105+'\x20#'+_0x37c7a1+_0x39e3bb(0x133)+_0x59c1ff+')';}else logger['debug'](_0x39e3bb(0x144)),_0x584b2c[_0x39e3bb(0x12a)](_0x34d185);break;}case _0x39e3bb(0x116):{_0x554cc0+=_0x34d185[_0x39e3bb(0x18a)];break;}case _0x39e3bb(0xf8):{_0x2fd4a0=_0x34d185;break;}case'at':{_0x5e9dd6=_0x34d185;break;}default:{_0x584b2c[_0x39e3bb(0x12a)](_0x34d185);}}}_0x17e0ec[_0x39e3bb(0x129)]>0x0&&_0x584b2c[_0x39e3bb(0x12a)](..._0x17e0ec);let _0x39c449={'type':_0x39e3bb(0x116),'content':_0x554cc0},_0x52d8e2=_0x2fd4a0?[_0x39c449,_0x2fd4a0]:[_0x39c449];if(_0x5e9dd6)_0x52d8e2['push'](_0x5e9dd6);logger['debug'](_0x52d8e2);if(!_0x554cc0)return await originalPreprocess['bind'](this)(_0x584b2c,_0x1a7571);else{if(_0x584b2c[_0x39e3bb(0x129)]!==0x0)return{'md':_0x52d8e2,'left':_0x584b2c};else{let _0x1192e7=await sendMarkdown(this['c'],_0x52d8e2,!![]);return{'rich':_0x1192e7,'left':_0x584b2c,'md':_0x52d8e2};}}},Contactable['prototype']['makeForwardMsg']=async function(_0x300e13){const _0x1a9b6f=_0x1c8d6a,_0x1ff5fa=this['c']['apk']['nt'];!Array[_0x1a9b6f(0x11b)](_0x300e13)&&(_0x300e13=[_0x300e13]);const _0x3fc44f=[],_0x4b67df=[];let _0x4783ca=[],_0x36756e=0x0,_0x50b5f9=[],_0x32b747;for(const _0x1a327d of _0x300e13){_0x32b747=null;if(!Array[_0x1a9b6f(0x11b)](_0x1a327d[_0x1a9b6f(0x103)]))_0x1a327d[_0x1a9b6f(0x103)]=[_0x1a327d[_0x1a9b6f(0x103)]];if(_0x1a327d['message']['length']===0x1&&typeof _0x1a327d['message'][0x0]!==_0x1a9b6f(0x187)&&[_0x1a9b6f(0x11f),_0x1a9b6f(0x12f)][_0x1a9b6f(0x149)](_0x1a327d['message'][0x0][_0x1a9b6f(0x117)])){const _0x2aa56f=_0x1a327d[_0x1a9b6f(0x103)][0x0];let _0x32ec5d,_0x456b54;if(_0x2aa56f[_0x1a9b6f(0x117)]===_0x1a9b6f(0x11f)){let _0xb89d5=/brief="(.*?)"/gm[_0x1a9b6f(0x107)](_0x2aa56f[_0x1a9b6f(0x154)]);if(_0xb89d5&&_0xb89d5[_0x1a9b6f(0x129)]>0x0)_0x32b747=_0xb89d5[0x1];else _0x32b747=_0x1a9b6f(0x185);let _0x4c3c47=/m_resid="(.*?)"/gm[_0x1a9b6f(0x107)](_0x2aa56f[_0x1a9b6f(0x154)]),_0x1894e6=/m_fileName="(.*?)"/gm[_0x1a9b6f(0x107)](_0x2aa56f[_0x1a9b6f(0x154)]);_0x4c3c47&&_0x4c3c47[_0x1a9b6f(0x129)]>0x1&&_0x1894e6&&_0x1894e6['length']>0x1&&(_0x32ec5d=_0x4c3c47[0x1],_0x456b54=_0x1894e6[0x1]);}else{if(_0x2aa56f['type']===_0x1a9b6f(0x12f)){_0x32b747='[JSON]';let _0x284fe2;try{_0x284fe2=typeof _0x2aa56f[_0x1a9b6f(0x154)]===_0x1a9b6f(0x16a)?_0x2aa56f[_0x1a9b6f(0x154)]:JSON[_0x1a9b6f(0x168)](_0x2aa56f[_0x1a9b6f(0x154)]);}catch(_0x3ad7a2){}if(_0x284fe2){_0x32b747=_0x284fe2[_0x1a9b6f(0x166)];if(_0x284fe2[_0x1a9b6f(0x15f)]==='com.tencent.multimsg'&&_0x284fe2[_0x1a9b6f(0x15d)]?.[_0x1a9b6f(0x197)]){let _0x15e549=_0x284fe2[_0x1a9b6f(0x15d)][_0x1a9b6f(0x197)];_0x32ec5d=_0x15e549[_0x1a9b6f(0x181)],_0x456b54=_0x15e549[_0x1a9b6f(0x153)];}}}}if(_0x32ec5d&&_0x456b54){const _0x473aba=_0x1ff5fa?await this['_newDownloadMultiMsg'](String(_0x32ec5d),this['dm']?0x1:0x2):await this[_0x1a9b6f(0x193)](String(_0x32ec5d),this['dm']?0x1:0x2);let _0xc6e9d7=_0x2a5971[_0x1a9b6f(0x178)](_0x473aba)[0x2];if(!Array[_0x1a9b6f(0x11b)](_0xc6e9d7))_0xc6e9d7=[_0xc6e9d7];for(let _0x429b9f of _0xc6e9d7){let _0x5c883c=_0x429b9f[0x1]['toString']();_0x5c883c===_0x1a9b6f(0x161)?_0x50b5f9[_0x1a9b6f(0x12a)]({0x1:_0x456b54,0x2:_0x429b9f[0x2]}):_0x50b5f9[_0x1a9b6f(0x12a)](_0x429b9f);}}}const _0x3831c5=await originalPreprocess[_0x1a9b6f(0x145)](this)(_0x1a327d[_0x1a9b6f(0x103)]);_0x3831c5?.[_0x1a9b6f(0x11c)]&&_0x32b747&&(_0x3831c5[_0x1a9b6f(0x11c)]=_0x32b747);_0x4b67df[_0x1a9b6f(0x12a)](_0x3831c5);const _0x2578f3=randomBytes(0x2)['readInt16BE'](),_0x39be8c=randomBytes(0x4)[_0x1a9b6f(0x189)]();let _0x35b3f0=String(_0x1a327d[_0x1a9b6f(0x180)]||_0x1a327d['user_id']);!_0x35b3f0&&_0x1a327d instanceof PrivateMessage&&(_0x35b3f0=this['c']['fl'][_0x1a9b6f(0x141)](_0x1a327d['user_id'])?.[_0x1a9b6f(0x180)]||this['c']['sl'][_0x1a9b6f(0x141)](_0x1a327d[_0x1a9b6f(0x100)])?.[_0x1a9b6f(0x180)]||_0x35b3f0),_0x36756e<0x4&&(_0x4783ca['push']({'text':escapeXml(_0x35b3f0)+':\x20'+escapeXml(_0x3831c5[_0x1a9b6f(0x11c)][_0x1a9b6f(0x110)](0x0,0x32))}),_0x36756e++),_0x1ff5fa?_0x3fc44f[_0x1a9b6f(0x12a)]({0x1:{0x1:_0x1a327d[_0x1a9b6f(0x100)],0x6:this['dm']?this['c'][_0x1a9b6f(0x18d)]:null,0x8:this['dm']?null:{0x1:this[_0x1a9b6f(0x174)],0x2:_0x35b3f0,0x5:0x2}},0x2:{0x1:this['dm']?0xa6:0x52,0x4:_0x39be8c,0x5:_0x2578f3,0x6:_0x1a327d[_0x1a9b6f(0x155)]||timestamp(),0x7:0x1,0x8:0x0,0x9:0x0},0x3:{0x1:_0x3831c5[_0x1a9b6f(0x131)]}}):_0x3fc44f[_0x1a9b6f(0x12a)]({0x1:{0x1:_0x1a327d[_0x1a9b6f(0x100)],0x2:this[_0x1a9b6f(0x174)],0x3:this['dm']?0xa6:0x52,0x4:this['dm']?0xb:null,0x5:_0x2578f3,0x6:_0x1a327d[_0x1a9b6f(0x155)]||timestamp(),0x7:rand2uuid(_0x39be8c),0x9:this['dm']?null:{0x1:this[_0x1a9b6f(0x174)],0x4:_0x35b3f0},0xe:this['dm']?_0x35b3f0:null,0x14:{0x1:0x0,0x2:_0x39be8c}},0x3:{0x1:_0x3831c5[_0x1a9b6f(0x131)]}});}_0x50b5f9[_0x1a9b6f(0x12a)]({0x1:_0x1a9b6f(0x161),0x2:{0x1:_0x3fc44f}});const _0x22d220=await gzip(_0x2a5971['encode']({0x2:_0x50b5f9}));let _0x183161;try{_0x183161=_0x1ff5fa?await this[_0x1a9b6f(0x162)](_0x22d220):await this[_0x1a9b6f(0x126)](_0x22d220);}catch{_0x183161=_0x1ff5fa?await this[_0x1a9b6f(0x162)](_0x22d220):await this[_0x1a9b6f(0x126)](_0x22d220);}const _0x5cf66d={'app':_0x1a9b6f(0x10d),'config':{'autosize':0x1,'forward':0x1,'round':0x1,'type':_0x1a9b6f(0x115),'width':0x12c},'desc':_0x1a9b6f(0x10e),'extra':'','meta':{'detail':{'news':_0x4783ca,'resid':_0x183161,'source':'群聊的聊天记录','summary':'查看'+_0x3fc44f['length']+_0x1a9b6f(0x138),'uniseq':uuid()[_0x1a9b6f(0x142)]()}},'prompt':_0x1a9b6f(0x10e),'ver':_0x1a9b6f(0x18e),'view':'contact'};return{'type':_0x1a9b6f(0x12f),'data':_0x5cf66d};},Group[_0x1c8d6a(0x16b)][_0x1c8d6a(0x156)]=async function(_0x334f31,_0x3535de,_0x5039fd){const _0x4bcb47=_0x1c8d6a,_0x18689c=await this[_0x4bcb47(0x183)](_0x334f31,_0x3535de);_0x18689c[_0x4bcb47(0x124)]&&_0x18689c['left']['length']>0x0&&await originalSendMsg[_0x4bcb47(0x145)](this)(_0x18689c['left'],_0x3535de,_0x5039fd);if(_0x18689c['md']&&_0x18689c['md']['length']>0x0)return await originalSendMsg[_0x4bcb47(0x145)](this)(_0x18689c['md'],![],_0x5039fd);return await originalSendMsg['bind'](this)(_0x334f31,_0x3535de,_0x5039fd);},User[_0x1c8d6a(0x16b)][_0x1c8d6a(0x156)]=async function(_0x52d232,_0x3553a2){const _0x3314cf=_0x1c8d6a,_0x5de096=await this[_0x3314cf(0x183)](_0x52d232,_0x3553a2);_0x5de096['left']&&_0x5de096[_0x3314cf(0x124)][_0x3314cf(0x129)]>0x0&&await originalSendMsgPrivate[_0x3314cf(0x145)](this)(_0x5de096[_0x3314cf(0x124)],_0x3553a2);if(_0x5de096['md']&&_0x5de096['md'][_0x3314cf(0x129)]>0x0)return await originalSendMsgPrivate[_0x3314cf(0x145)](this)(_0x5de096['md'],![]);return await originalSendMsgPrivate['bind'](this)(_0x52d232,_0x3553a2);};export async function sendMarkdown(_0x3af9ee,_0x4a0c51=[],_0x104156=![]){const _0x25db7e=_0x1c8d6a;!Array[_0x25db7e(0x11b)](_0x4a0c51)&&(_0x4a0c51=[_0x4a0c51]);let _0x25f4f3=_0x4a0c51['find'](_0x2e6092=>_0x2e6092['type']==='markdown')['content'],_0x22f1b1=_0x4a0c51[_0x25db7e(0x172)](_0x1d540f=>_0x1d540f[_0x25db7e(0x117)]==='at'),_0x4c0a8b;if(_0x22f1b1){let _0x4c58fb=_0x22f1b1['qq'];if(_0x4c58fb!==_0x25db7e(0x151)){let _0x322076=Bot[_0x25db7e(0x18b)][_0x25db7e(0x141)](_0x3af9ee[_0x25db7e(0x120)])?.[_0x25db7e(0x141)](_0x4c58fb);_0x4c0a8b=makeAtElement(_0x22f1b1,_0x322076);if(!_0x22f1b1['notext']){let _0x1c2ad1='[@'+_0x322076?.[_0x25db7e(0x10c)]+']';_0x25f4f3=_0x1c2ad1+('(mqqapi://markdown/mention?at_type=2&at_tinyid='+_0x22f1b1['qq']+')\x0a')+_0x25f4f3;}}else _0x25f4f3=_0x25db7e(0x122)+_0x25f4f3,_0x4c0a8b=makeAtElement(_0x22f1b1);}let _0x42920d=[_0x2a5971[_0x25db7e(0x14e)]({0x35:{0x1:0x2d,0x2:{0x1:_0x25f4f3},0x3:0x1}})];_0x4c0a8b&&_0x42920d['push'](_0x4c0a8b);_0x4a0c51[_0x25db7e(0x132)](_0xe02af1=>_0xe02af1[_0x25db7e(0x117)]===_0x25db7e(0xf8))[_0x25db7e(0x11e)](_0x2f7552=>{const _0x12233e=_0x25db7e,{content:_0x35c5d1}=_0x2f7552;if(!_0x35c5d1['rows'])return;const _0x467b89={0x1:{0x1:_0x35c5d1[_0x12233e(0x190)]['map'](_0x27f498=>{const _0x159f9e=_0x12233e;return{0x1:_0x27f498[_0x159f9e(0x15a)][_0x159f9e(0x101)](_0x228df6=>{const _0x3cdac4=_0x159f9e;return{0x1:_0x228df6['id'],0x2:{0x1:_0x228df6['render_data'][_0x3cdac4(0x152)],0x2:_0x228df6[_0x3cdac4(0x175)]['visited_label'],0x3:_0x228df6['render_data']['style']},0x3:{0x1:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x117)],0x2:{0x1:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x14d)][_0x3cdac4(0x117)],0x2:_0x228df6['action'][_0x3cdac4(0x14d)]['specify_role_ids'],0x3:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x14d)][_0x3cdac4(0x12c)]},0x4:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x192)],0x5:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x154)],0x7:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x176)]?0x1:0x0,0x8:_0x228df6[_0x3cdac4(0x177)][_0x3cdac4(0x16e)]?0x1:0x0}};})};}),0x2:_0x35c5d1[_0x12233e(0xfe)]}};_0x42920d[_0x12233e(0x12a)](_0x2a5971[_0x12233e(0x14e)]({0x35:{0x1:0x2e,0x2:_0x467b89,0x3:0x1}}));});let _0x3adffe={0x1:{0x1:Bot[_0x25db7e(0x18d)],0x2:Bot[_0x25db7e(0x17a)],0x6:Bot['uin']+'',0x7:{0x6:Bot[_0x25db7e(0x180)]}},0x2:{0x1:0x9,0x2:0xaf,0x3:0xaf,0x4:randomBytes(0x4)[_0x25db7e(0x189)](),0x5:randomBytes(0x4)[_0x25db7e(0x189)](),0x6:Math['floor'](Date[_0x25db7e(0x12b)]()/0x3e8),0x7:0x1,0x8:0x0,0x9:0x0,0xb:randomBytes(0x4)[_0x25db7e(0x189)](),0xf:{0x1:0x0,0x2:0x0,0x3:0x2,0x4:'',0x5:''}},0x3:{0x1:{0x2:_0x42920d}}},_0x6a5daf=_0x2a5971[_0x25db7e(0x14e)]({0x2:{0x1:_0x25db7e(0x161),0x2:{0x1:_0x3adffe}}}),_0x2ab898=Math[_0x25db7e(0x195)](Math[_0x25db7e(0x165)]()*0x2710)+0x2710,_0x3916d4={0x2:{0x1:0x1,0x2:{0x2:_0x2ab898+''},0x3:_0x2ab898,0x4:await gzip(_0x6a5daf)},0xf:{0x1:0x4,0x2:0x2,0x3:0x9,0x4:0x0}};const _0x55d20a=await Bot[_0x25db7e(0x191)](_0x25db7e(0x140),_0x2a5971[_0x25db7e(0x14e)](_0x3916d4)),_0xd5000d=_0x2a5971[_0x25db7e(0x178)](_0x55d20a)?.[0x2];let _0x548985=_0xd5000d[0x3]['toString']();logger[_0x25db7e(0x18f)]('resId\x20got:\x20'+_0x548985);if(_0x104156)return{0x2:{0x25:{0x6:0x1,0x7:_0x548985}}};let _0x77a9e2={0x1:_0x3af9ee[_0x25db7e(0x13c)]?{0x2:{0x1:_0x3af9ee['group_id']}}:{0x1:{0x1:_0x3af9ee[_0x25db7e(0x12e)][_0x25db7e(0x17a)]}},0x2:{0x1:0x1,0x2:0x0,0x3:0x0},0x3:{0x1:{0x2:{0x25:{0x6:0x1,0x7:_0x548985}}}},0x4:randomBytes(0x2)['readUInt16BE'](),0x5:randomBytes(0x4)['readUInt32BE']()};_0x77a9e2=_0x2a5971['encode'](_0x77a9e2),await Bot[_0x25db7e(0x191)]('MessageSvc.PbSendMsg',_0x77a9e2);}function _text(_0x57057d,_0x4d59c9){const _0x58e073=_0x1c8d6a;_0x57057d=String(_0x57057d);if(!_0x57057d[_0x58e073(0x129)])return;this[_0x58e073(0x111)][_0x58e073(0x12a)]({0x1:{0x1:_0x57057d,0x3:_0x4d59c9}}),this[_0x58e073(0x129)]+=_0x57057d[_0x58e073(0x129)],this[_0x58e073(0x11c)]+=_0x57057d;}function makeAtElement(_0x3db7ca,_0x5ae45c){const _0x4c45e2=_0x1c8d6a,_0x597833=Buffer['from']([0x0,0x1,0x0,0x0,0x0]),_0xbb7d00=Buffer['alloc'](0x2);let _0x2189f6,{qq:_0x28ce6b,text:_0x5b61b6,dummy:_0x226bc5}=_0x3db7ca;if(_0x28ce6b===_0x4c45e2(0x151))var _0x411fe1=0x0,_0x317149=0x1,_0x30ff24=_0x4c45e2(0x196);else _0x411fe1=Number(_0x28ce6b),_0x317149=0x0,_0x30ff24=_0x5b61b6||String(_0x28ce6b),_0x2189f6=_0x5ae45c?.[_0x4c45e2(0x17a)]||'',!_0x5b61b6&&(_0x30ff24=_0x5ae45c?.[_0x4c45e2(0x10c)]||_0x5ae45c?.['nickname']||_0x30ff24);_0x30ff24='@'+_0x30ff24;if(_0x226bc5)return _text(_0x30ff24);const _0xe1cb6f=Buffer[_0x4c45e2(0x136)](0x6);_0xe1cb6f['writeUInt8'](_0x30ff24[_0x4c45e2(0x129)]),_0xe1cb6f['writeUInt8'](_0x317149,0x1),_0xe1cb6f[_0x4c45e2(0x130)](_0x411fe1,0x2);const _0x144aa7=Buffer['concat']([_0x597833,_0xe1cb6f,_0xbb7d00]);return _0x2a5971['encode']({0x1:{0x1:_0x30ff24,0x3:_0x144aa7,0xc:{0x3:_0x317149===0x1?0x1:0x2,0x4:_0x411fe1,0x5:0x0,0x9:_0x411fe1===0x0?_0x4c45e2(0x151):_0x2189f6,0xb:0x0}}});}export class mdTest extends _0x389e23{constructor(){const _0x5ce5cf=_0x1c8d6a;super({'name':'md','dsc':'md','event':_0x5ce5cf(0x103),'priority':-0x5af3107a4000,'rule':[{'reg':'^#?md','fnc':'md'}]}),(!segment[_0x5ce5cf(0x116)]||typeof segment['markdown']!=='function')&&(segment[_0x5ce5cf(0x116)]=_0x1510cd=>{const _0x59c317=_0x5ce5cf;return{'type':_0x59c317(0x116),'content':_0x1510cd};});}async['md'](_0x79d3ab){const _0x447556=_0x1c8d6a;let _0x4cc255=_0x79d3ab[_0x447556(0x134)][_0x447556(0x135)](/^#?md/,''),_0x8cfe89=segment[_0x447556(0x116)](_0x4cc255);await sendMarkdown(_0x79d3ab,[_0x8cfe89]);}}
